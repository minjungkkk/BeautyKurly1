<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=395, initial-scale=1.0">
<title>Beauty Kurly|cart</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<link rel="stylesheet" href="css/reset.css">
<link rel="stylesheet" href="css/cart.css">
</head>
<body>

<header class="cart_header">
  <div class="header_left">
    <a href="#" class="close"><i class="fas fa-xmark"></i></a>
    <span class="header_title">장바구니</span>
  </div>
  <div class="header_right">
    <a href="#" class="search"><i class="fas fa-magnifying-glass"></i></a>
    <a href="#" class="home"><i class="fas fa-house"></i></a>
  </div>
</header>
<section class="delivery_info">
  <div class="delivery_tag">샛별배송</div>
  <div class="delivery_address">
    <span>서울시 노원구 가나다로 1길 2, 한국아파트 101동 001호</span>
    <button class="btn_change">변경</button>
  </div>
  <div class="free_delivery free">
  <span class="delivery_text">n원 추가 시 무료 배송</span>
  <div class="delivery_range" >
    <div class="delivery_progress" style="width: 80%;"></div>
  </div>
</div>
</section>
<section class="cart_tabs">
  <button class="tab active">담은 상품 <span class="item_count">2</span></button>
  <button class="tab">자주 구매 상품</button>
</section>

<section class="cart_select">
  <div class="select_left">
    <input type="checkbox" id="select_all">
    <label for="select_all">전체선택</label>
  </div>
  <button class="select_delete">선택삭제</button>
</section>

<section class="cart_items">

  <div class="cart_item">
    <div class="item_left">
      <img src="images/cart_in1.jpg" alt="상품1">
      <div class="item_count">
        <button class="minus">-</button>
        <span>1</span>
        <button class="plus">+</button>
      </div>
    </div>
    <div class="item_right">
      <input type="checkbox">
      <div class="item_name">[포트레] 핸드 크림 누보30ml</div>
      <div class="item_price">
        <div class="before">20,000원</div>
        <div class="after">16,150원</div>
      </div>
    </div>
  </div>

  <div class="cart_item">
    <div class="item_left">
      <img src="images/cart_in2.jpg" alt="상품2">
      <div class="item_count">
        <button class="minus">-</button>
        <span>1</span>
        <button class="plus">+</button>
      </div>
    </div>
    <div class="item_right">
      <input type="checkbox">
      <div class="item_name">[에스트라] 아토베리어365 클렌징밀크 200ml (+밀크 30ml)</div>
      <div class="item_price">
        <div class="before">29,000원</div>
        <div class="after">22,620원</div>
      </div>
    </div>
  </div>
</section>

<section class="cart_summary">
  <div class="summary_row">
    <span>상품금액</span>
    <span>38,770원</span>
  </div>
  <div class="summary_row">
    <span>상품할인금액</span>
    <span class="discount">-10,230원</span>
  </div>
  <div class="summary_row">
    <span>배송비</span>
    <span>2,500원</span>
  </div>
</section>

<section class="total_pay"> 
  <span class="total_price">41,270원</span> 주문하기</section>


<!-- 여기~~~ -->
<section class="recommend_products">
  <div class="recommend_title">
    <i class="fas fa-star"></i>
    <span>건조한 겨울에 어울리는 상품 추천</span>
  </div>
  <div class="recommend_list">
    <div class="rec_item">
      <p class="delivery_tag">샛별배송</p>
      <img src="images/cart_rec1.jpg" alt="recommend_products">
      <div class="rec_name">[라부르켓] BEST 립 밤 3종 (택1)</div>
      <p class="product_price_before">원</p>
        <p class="product_price">
          <span class="discount">%</span>
          <span class="price">20,655원</span>
        </p>
        <div class="product_icon">
          <i class="fa-regular fa-heart"></i>
          <i class="fa-solid fa-cart-shopping"></i>
        </div>
    </div>
    <div class="rec_item">
      <p class="delivery_tag">샛별배송</p>
      <img src="images/cart_rec2.jpg" alt="recommend_products">
      <div class="rec_name">[눅스] 메르비앙스 리프트 오일세럼 30ml</div>
      <p class="product_price_before">원</p>
        <p class="product_price">
          <span class="discount">%</span>
          <span class="price">66,600원</span>
        </p>
        <div class="product_icon">
          <i class="fa-regular fa-heart"></i>
          <i class="fa-solid fa-cart-shopping"></i>
        </div>
    </div>
    <div class="rec_item">
      <p class="delivery_tag">샛별배송</p>
      <img src="images/cart_rec3.jpg" alt="recommend_products">
      <div class="rec_name">[디어달리아] 파라다이스 블루밍밤 3.1g</div>
      <p class="product_price_before">원</p>
        <p class="product_price">
          <span class="discount">%</span>
          <span class="price">25,200원</span>
        </p>
        <div class="product_icon">
          <i class="fa-regular fa-heart"></i>
          <i class="fa-solid fa-cart-shopping"></i>
        </div>
    </div>
    <div class="rec_item">
      <p class="delivery_tag">샛별배송</p>
      <img src="images/cart_rec4.jpg" alt="recommend_products">
      <div class="rec_name">[키엘] 울트라 훼이셜 어드밴스드 리페어 베리어 크림 50ml</div>
      <p class="product_price_before">원</p>
        <p class="product_price">
          <span class="discount">%</span>
          <span class="price">69,700원</span>
        </p>
        <div class="product_icon">
          <i class="fa-regular fa-heart"></i>
          <i class="fa-solid fa-cart-shopping"></i>
        </div>
    </div>
    <div class="rec_item">
      <p class="delivery_tag">샛별배송</p>
      <img src="images/cart_rec5.jpg" alt="recommend_products">
      <div class="rec_name">[닥터지] 블랙 스네일 크림 50ml*2개 (+크림15ml증정)</div>
      <p class="product_price_before">원</p>
        <p class="product_price">
          <span class="discount">%</span>
          <span class="price">24,000원</span>
        </p>
        <div class="product_icon">
          <i class="fa-regular fa-heart"></i>
          <i class="fa-solid fa-cart-shopping"></i>
        </div>
    </div>
    <div class="rec_item">
      <p class="delivery_tag">샛별배송</p>
      <img src="images/cart_rec6.jpg" alt="recommend_products">
      <div class="rec_name">[라로슈포제]시카플라스트 밤 B5+ 100ml/ 40ml(택1)</div>
      <p class="product_price_before">00000원</p>
        <p class="product_price">
          <span class="discount">20%</span>
          <span class="price">38,950원</span>
        </p>
        <div class="product_icon">
          <i class="fa-regular fa-heart"></i>
          <i class="fa-solid fa-cart-shopping"></i>
        </div>
    </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {

  /* 헤더 아이콘 */
  const headerX = document.querySelector('.header_left a');
  const headerSearch = document.querySelector('.header_right a:nth-child(1)');
  const headerHome = document.querySelector('.header_right a:nth-child(2)');

  headerX.addEventListener('click', () => {
    history.back();
  });

  headerSearch.addEventListener('click', () => {
    location.href = 'search.html'; // 검색 페이지
  });

  headerHome.addEventListener('click', () => {
    location.href = 'home.html'; // 홈 페이지
  });

  const deliveryProgress = document.querySelector('.delivery_progress');
  const deliveryText = document.querySelector('.delivery_text');
  const totalPrice = document.querySelector('.total_price'); // total_pay 안에 span으로 숫자만
  const freeDeliveryAmount = 40000;

  let cartItems = document.querySelectorAll('.cart_item');

  // 총액 계산
  function calculateTotal() {
    let total = 0;
    cartItems.forEach(item => {
      const priceText = item.querySelector('.item_price .after').textContent.replace(/[^0-9]/g,'');
      const count = parseInt(item.querySelector('.item_count span').textContent);
      total += parseInt(priceText) * count;
    });
    return total;
  }

  function updateDeliveryProgress() {
    const total = calculateTotal();
    const percent = Math.min(total / freeDeliveryAmount * 100, 100);
    deliveryProgress.style.width = percent + '%';

    totalPrice.textContent = total.toLocaleString() + '원';

    if(total >= freeDeliveryAmount){
      deliveryText.textContent = "무료배송 달성!";
      deliveryProgress.parentElement.classList.add('free');
    } else {
      deliveryText.textContent = (freeDeliveryAmount - total).toLocaleString() + "원 추가 시 무료 배송";
      deliveryProgress.parentElement.classList.remove('free');
    }
  }

  function bindCountEvents() {
    cartItems.forEach(item => {
      const minusBtn = item.querySelector('.minus');
      const plusBtn = item.querySelector('.plus');
      const countSpan = item.querySelector('.item_count span');

      minusBtn.onclick = () => {
        let count = parseInt(countSpan.textContent);
        if(count > 1){
          count--;
          countSpan.textContent = count;
          updateDeliveryProgress();
        }
      };

      plusBtn.onclick = () => {
        let count = parseInt(countSpan.textContent);
        count++;
        countSpan.textContent = count;
        updateDeliveryProgress();
      };
    });
  }

  // 선택 삭제
  const selectDelete = document.querySelector('.select_delete');
  selectDelete.onclick = () => {
    cartItems.forEach(item => {
      const chk = item.querySelector('input[type="checkbox"]');
      if(chk.checked) item.remove();
    });
    cartItems = document.querySelectorAll('.cart_item'); // 재선택
    bindCountEvents(); // 이벤트 재바인딩
    updateDeliveryProgress();
  };

  bindCountEvents();
  updateDeliveryProgress();
 







  /* 상품 개수 증감하기 */
  const cart_Items = document.querySelectorAll('.cart_item');

  cart_Items.forEach(item => {
    const minusBtn = item.querySelector('.minus');
    const plusBtn = item.querySelector('.plus');
    const countSpan = item.querySelector('.item_count span');

    minusBtn.addEventListener('click', () => {
      let count = parseInt(countSpan.textContent);
      if(count > 1) {
        count--;
        countSpan.textContent = count;
      }
    });

    plusBtn.addEventListener('click', () => {
      let count = parseInt(countSpan.textContent);
      count++;
      countSpan.textContent = count;
    });
  });

  /* 전체 선택, 선택 삭제 기능 부분 */
  const selectAll = document.getElementById('select_all');
  const select_Delete = document.querySelector('.select_delete');

  selectAll.addEventListener('change', () => {
    const checkboxes = document.querySelectorAll('.cart_item input[type="checkbox"]');
    checkboxes.forEach(chk => {
      chk.checked = selectAll.checked;
    });
  });

  selectDelete.addEventListener('click', () => {
    const items = document.querySelectorAll('.cart_item');
    items.forEach(item => {
      const chk = item.querySelector('input[type="checkbox"]');
      if(chk.checked) {
        item.remove();
      }
    });
  });

  /* 탭 전환하기 */
  const tabs = document.querySelectorAll('.cart_tabs .tab');

  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      tabs.forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
    });
  });

});
</script>
</body>
</html>
